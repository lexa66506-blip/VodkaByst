<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - Dissent</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background: #0d0d0d; color: #fff; min-height: 100vh; }

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
.navbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px 40px;
    background: #111;
    border-bottom: 1px solid #222;
}
.nav-left { display: flex; align-items: center; gap: 30px; }
.nav-logo { font-size: 20px; font-weight: 700; color: #fff; display: flex; align-items: center; gap: 10px; }
.nav-logo img { width: 28px; height: 28px; }
.nav-links { display: flex; gap: 25px; }
.nav-links a { color: #888; text-decoration: none; font-size: 14px; transition: color 0.3s; }
.nav-links a:hover { color: #fff; }
.nav-right { display: flex; align-items: center; gap: 15px; }
.btn-cabinet { padding: 8px 20px; background: #e85d04; border: none; border-radius: 6px; color: #fff; font-size: 13px; cursor: pointer; }

/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
.main-container { display: flex; max-width: 1400px; margin: 30px auto; padding: 0 30px; gap: 30px; }

/* –°–∞–π–¥–±–∞—Ä */
.sidebar {
    width: 220px;
    background: #151515;
    border-radius: 12px;
    padding: 20px;
    height: fit-content;
}
.sidebar-title { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
.sidebar-subtitle { font-size: 12px; color: #666; margin-bottom: 20px; }
.sidebar-menu { display: flex; flex-direction: column; gap: 5px; }
.sidebar-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 12px; border-radius: 8px;
    color: #888; font-size: 13px; cursor: pointer; transition: all 0.3s;
}
.sidebar-item:hover, .sidebar-item.active { background: #1a1a1a; color: #fff; }
.sidebar-item.active { background: #e85d04; }

/* –ö–æ–Ω—Ç–µ–Ω—Ç */
.content { flex: 1; }
.content-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
.content-title { font-size: 18px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
.content-title::before { content: '‚óè'; color: #e85d04; }
.header-buttons { display: flex; gap: 10px; }
.btn-action {
    padding: 8px 16px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.3s;
    display: flex; align-items: center; gap: 6px;
}
.btn-key { background: transparent; border: 1px solid #e85d04; color: #e85d04; }
.btn-download { background: transparent; border: 1px solid #444; color: #888; }
.btn-logout { background: #e85d04; border: none; color: #fff; }

/* –ü–∞–Ω–µ–ª—å –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö */
.panel {
    background: #151515;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 20px;
}
.panel-title { font-size: 15px; font-weight: 600; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
.panel-subtitle { font-size: 12px; color: #666; margin-bottom: 20px; }

/* –ü–æ–ª—è –≤–≤–æ–¥–∞ */
.form-row { display: flex; gap: 20px; margin-bottom: 15px; }
.form-group { flex: 1; }
.form-label { font-size: 11px; color: #888; margin-bottom: 6px; display: block; }
.form-input {
    width: 100%; padding: 12px 15px;
    background: #1a1a1a; border: 1px solid #2a2a2a; border-radius: 8px;
    color: #fff; font-size: 13px;
}
.form-input:disabled { color: #666; }
.form-input::placeholder { color: #555; }

/* –ò–Ω—Ñ–æ –±–ª–æ–∫–∏ */
.info-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; }
.info-block { }
.info-label { font-size: 11px; color: #666; margin-bottom: 4px; display: flex; align-items: center; gap: 5px; }
.info-value { font-size: 13px; color: #fff; }
.info-value.orange { color: #e85d04; }

/* –°–µ–∫—Ü–∏—è –ø–∞—Ä–æ–ª—è */
.password-section { margin-top: 25px; padding-top: 20px; border-top: 1px solid #222; }
.password-title { font-size: 14px; font-weight: 600; margin-bottom: 5px; display: flex; align-items: center; gap: 8px; }
.password-subtitle { font-size: 11px; color: #666; margin-bottom: 15px; }
.password-row { display: flex; gap: 15px; align-items: flex-end; }
.password-row .form-group { flex: 1; }
.btn-change-pass {
    padding: 12px 20px; background: #1a1a1a; border: 1px solid #333;
    border-radius: 8px; color: #888; font-size: 12px; cursor: pointer; white-space: nowrap;
}

/* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å */
.right-panel { width: 280px; }
.right-card {
    background: #151515; border-radius: 12px; padding: 20px; margin-bottom: 15px;
}
.right-card-title { font-size: 12px; color: #888; margin-bottom: 10px; }
.subscription-status { font-size: 12px; color: #666; margin-bottom: 8px; }
.subscription-status.active { color: #4ade80; }
.btn-products {
    width: 100%; padding: 10px; background: #e85d04; border: none;
    border-radius: 6px; color: #fff; font-size: 12px; cursor: pointer; margin-top: 10px;
}
.versions-title { font-size: 11px; color: #666; margin: 15px 0 8px; }
.versions-list { display: flex; gap: 8px; }
.version-badge {
    padding: 4px 10px; background: #1a1a1a; border-radius: 4px;
    font-size: 11px; color: #888;
}
.btn-discord {
    width: 100%; padding: 10px; background: #1a1a1a; border: 1px solid #333;
    border-radius: 6px; color: #888; font-size: 12px; cursor: pointer; margin-top: 10px;
}

/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center; }
.modal.active { display: flex; }
.modal-content { background: #151515; border-radius: 12px; padding: 25px; width: 400px; max-width: 90%; }
.modal-title { font-size: 18px; margin-bottom: 20px; }
.modal-input { width: 100%; padding: 12px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px; color: #fff; margin-bottom: 15px; }
.modal-buttons { display: flex; gap: 10px; }
.modal-btn { flex: 1; padding: 12px; border-radius: 8px; cursor: pointer; font-size: 13px; }
.modal-btn.primary { background: #e85d04; border: none; color: #fff; }
.modal-btn.secondary { background: transparent; border: 1px solid #333; color: #888; }
.modal-message { margin-top: 10px; padding: 10px; border-radius: 8px; font-size: 12px; display: none; }
</style>
</head>
<body>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav class="navbar">
    <div class="nav-left">
        <div class="nav-logo">
            <img src="Dissent.png" alt="Logo">
            Dissent
        </div>
        <div class="nav-links">
            <a href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="#">–ü—Ä–æ–¥—É–∫—Ç—ã</a>
            <a href="https://t.me/SmertnixVteste" target="_blank">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
        </div>
    </div>
    <div class="nav-right">
        <button class="btn-cabinet">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</button>
    </div>
</nav>

<div class="main-container">
    <!-- –°–∞–π–¥–±–∞—Ä -->
    <div class="sidebar">
        <div class="sidebar-title">‚Üê –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
        <div class="sidebar-subtitle">–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ</div>
        <div class="sidebar-menu">
            <div class="sidebar-item active">‚öô –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="content">
        <div class="content-header">
            <div class="content-title">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
            <div class="header-buttons">
                <button class="btn-action btn-key" onclick="openModal('key')">‚ú¶ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
                <button class="btn-action btn-download" id="downloadBtn">‚¨á –°–∫–∞—á–∞—Ç—å –ª–∞—É–Ω—á–µ—Ä</button>
                <button class="btn-action btn-logout" id="logoutBtn">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <div class="panel">
            <div class="panel-title">‚óè –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</div>
            <div class="panel-subtitle">–í–∞—à–∏ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤–∞–º</div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">–ù–∏–∫–Ω–µ–π–º</label>
                    <input type="text" class="form-input" id="inputUsername" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">–ü–æ—á—Ç–∞</label>
                    <input type="text" class="form-input" id="inputEmail" disabled>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">–ü—Ä–æ–º–æ–∫–æ–¥</label>
                <input type="text" class="form-input" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç" disabled>
            </div>

            <div class="info-grid">
                <div class="info-block">
                    <div class="info-label">‚óè UID</div>
                    <div class="info-value orange" id="infoUid">0</div>
                </div>
                <div class="info-block">
                    <div class="info-label">‚óè Role</div>
                    <div class="info-value" id="infoRole">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                </div>
                <div class="info-block">
                    <div class="info-label">‚óè –ó–∞–±–∞–Ω–µ–Ω?</div>
                    <div class="info-value" id="infoBanned">–ù–µ—Ç</div>
                </div>
                <div class="info-block">
                    <div class="info-label">‚óè HWID</div>
                    <div class="info-value" id="infoHwid" style="font-size: 10px;">-</div>
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ø–∞—Ä–æ–ª—è -->
            <div class="password-section">
                <div class="password-title">‚óè –ü–∞—Ä–æ–ª—å</div>
                <div class="password-subtitle">–ù–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</div>
                
                <div class="password-row">
                    <div class="form-group">
                        <label class="form-label">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-input" id="oldPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" class="form-input" id="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button class="btn-change-pass" onclick="changePassword()">–°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                </div>
                <div class="modal-message" id="passwordMessage"></div>
            </div>
        </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="right-panel">
        <div class="right-card">
            <div class="right-card-title">–ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞</div>
            <div class="subscription-status" id="subStatus">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏</div>
            <div id="subExpires" style="font-size: 11px; color: #666;"></div>
            <button class="btn-products" onclick="window.location.href='/#buyBtn'">+ –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–¥—É–∫—Ç–∞–º</button>
            
            <div class="versions-title">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –ø–æ–∫—É–ø–∫–∏</div>
            <div class="versions-list">
                <span class="version-badge">1.16.5</span>
                <span class="version-badge">1.16.5 Beta</span>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–ª—é—á–∞ -->
<div class="modal" id="keyModal">
    <div class="modal-content">
        <div class="modal-title">–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–ª—é—á–∞</div>
        <input type="text" class="modal-input" id="keyInput" placeholder="DST-XXXXXXXX-XXXXXXXX">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeModal('key')">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="activateKey()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div class="modal-message" id="keyMessage"></div>
    </div>
</div>

<!-- –°–∫—Ä—ã—Ç–∞—è –∞–¥–º–∏–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (Alt+N) -->
<div class="modal" id="adminModal">
    <div class="modal-content">
        <div class="modal-title" style="color: #e85d04;">üîê Admin Access</div>
        <input type="password" class="modal-input" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
        <div class="modal-buttons">
            <button class="modal-btn secondary" onclick="closeModal('admin')">–û—Ç–º–µ–Ω–∞</button>
            <button class="modal-btn primary" onclick="adminLogin()">–í–æ–π—Ç–∏</button>
        </div>
        <div class="modal-message" id="adminMessage"></div>
    </div>
</div>

<script>
let userData = null;

async function loadUserData() {
    try {
        const response = await fetch('/api/check-auth');
        const data = await response.json();
        
        if (!data.authenticated) {
            window.location.href = '/';
            return;
        }
        
        userData = data;
        
        document.getElementById('inputUsername').value = data.username;
        document.getElementById('inputEmail').value = data.email || '–ù–µ —É–∫–∞–∑–∞–Ω';
        document.getElementById('infoUid').textContent = data.uid;
        document.getElementById('infoHwid').textContent = data.hwid ? data.hwid.substring(0, 16) + '...' : '–ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω';
        
        if (data.subscription_active) {
            const expires = new Date(data.subscription_expires);
            document.getElementById('subStatus').textContent = '–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞';
            document.getElementById('subStatus').classList.add('active');
            document.getElementById('subExpires').textContent = '–î–æ: ' + expires.toLocaleDateString('ru-RU');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        window.location.href = '/';
    }
}

function openModal(type) { document.getElementById(type + 'Modal').classList.add('active'); }
function closeModal(type) { document.getElementById(type + 'Modal').classList.remove('active'); }

function showMessage(div, text, success) {
    div.style.display = 'block';
    div.style.background = success ? 'rgba(50, 255, 50, 0.2)' : 'rgba(255, 50, 50, 0.2)';
    div.style.color = success ? '#4ade80' : '#ff5555';
    div.textContent = text;
}

async function activateKey() {
    const keyCode = document.getElementById('keyInput').value.trim();
    const msg = document.getElementById('keyMessage');
    if (!keyCode) { showMessage(msg, '–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á', false); return; }
    
    try {
        const res = await fetch('/api/activate-key', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ key_code: keyCode })
        });
        const data = await res.json();
        showMessage(msg, data.message, data.success);
        if (data.success) setTimeout(() => { closeModal('key'); loadUserData(); }, 1500);
    } catch (e) { showMessage(msg, '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', false); }
}

async function changePassword() {
    const oldPass = document.getElementById('oldPassword').value;
    const newPass = document.getElementById('newPassword').value;
    const msg = document.getElementById('passwordMessage');
    if (!oldPass || !newPass) { showMessage(msg, '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', false); return; }
    
    try {
        const res = await fetch('/api/change-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ old_password: oldPass, new_password: newPass })
        });
        const data = await res.json();
        showMessage(msg, data.message, data.success);
        if (data.success) {
            document.getElementById('oldPassword').value = '';
            document.getElementById('newPassword').value = '';
        }
    } catch (e) { showMessage(msg, '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', false); }
}

document.getElementById('downloadBtn').addEventListener('click', () => {
    if (userData && userData.subscription_active) {
        window.open('https://www.dropbox.com/scl/fi/7p2hql3lhp3v98s633a3f/DissentClient.exe?rlkey=hchtczlxhm9dlidd2mlbpjn0u&st=w8h0f8un&dl=1', '_blank');
    } else { alert('–ù—É–∂–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞'); }
});

document.getElementById('logoutBtn').addEventListener('click', async () => {
    await fetch('/api/logout', { method: 'POST' });
    window.location.href = '/';
});

// Alt+N –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
document.addEventListener('keydown', (e) => {
    if (e.altKey && (e.key === 'n' || e.key === 'N' || e.key === '—Ç' || e.key === '–¢')) {
        e.preventDefault();
        if (localStorage.getItem('adminAuth') === 'true') {
            window.location.href = '/admin.html';
        } else {
            openModal('admin');
        }
    }
});

function adminLogin() {
    const pass = document.getElementById('adminPassword').value;
    const msg = document.getElementById('adminMessage');
    if (pass === 'dissent2024admin') {
        localStorage.setItem('adminAuth', 'true');
        showMessage(msg, '–î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω!', true);
        setTimeout(() => { window.location.href = '/admin.html'; }, 500);
    } else {
        showMessage(msg, '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å', false);
    }
}

loadUserData();
</script>
</body>
</html>
